import{a as y,_ as B}from "./index.7fe3d568.js";const D= k=>(Vue.pushScopeId("data-v-bef685b0"),k=k(),Vue.popScopeId(),k),L={class:"ContestRank",ref:"ContestRank"},N={class:"contestInfo"},E={class:"title"},w={class:"content"},x=D(()=>Vue.createElementVNode("br",null,null,-1)),C={class:"header"},T=D(()=>Vue.createElementVNode("div",{style:{width:"70px"}},"\u6392\u540D",-1)),F=D(()=>Vue.createElementVNode("div",{style:{width:"300px"}},"\u7528\u6237",-1)),M=D(()=>Vue.createElementVNode("div",{style:{width:"80px"}},"\u73ED\u7EA7",-1)),U=D(()=>Vue.createElementVNode("div",{style:{width:"80px"}},"\u603B\u5206",-1)),A={key:0,style:{width:"70px"}},R={class:"medalIcon"},$={key:1,style:{width:"70px"}},X={style:{width:"300px"}},z={style:{width:"80px"}},j={style:{width:"80px"}},O={key:0},q={key:1},J=Vue.defineComponent({__name:"ListRank",setup(k){const{proxy:i}=Vue.getCurrentInstance();y();var s=Vue.reactive({rankList:[],calculate(e){var o;let u=new Map,r=new Array;for(let t in a.Data)u[a.Data[t].PID]={index:-1,Time:1152921504606847e3},r.push(a.Data[t].PID);for(let t in e){var l=e[t];let n={TimePenalty:0,Solved:0,Problems:[],Uname:"",UID:"",Uclass:"",ProblemsMap:new Map,medal:0};n.UID=e[t].UID,n.Uname=e[t].Uname,n.Uclass=l.Uclass,n.Solved=l.Solved;for(let V in l.Problems){let c=l.Problems[V];if(c.PID==0)continue;if(c.Status=="AC"){n.TimePenalty+=c.Time;for(let b in a.Data)c.PID==a.Data[b].PID&&a.Data[b].Solved++;c.Time<((o=u[c.PID])==null?void 0:o.Time)&&(u[c.PID]={index:Number(t),Time:c.Time})}let g={Time:c.Time,SubmitNumber:c.SubmitNumber,Status:c.Status,Pioneer:!1};n.ProblemsMap[c.PID]=g}s.rankList.push(n)}for(let t in u)u[t].index!=-1&&(s.rankList[u[t].index].ProblemsMap[t].Pioneer=!0,console.log("pooner"));s.rankList.sort((t, n)=>t.Solved<n.Solved||t.Solved==n.Solved&&t.TimePenalty<n.TimePenalty?1:-1);let d=Number((s.rankList.length*.1).toFixed(0)),m=Number((s.rankList.length*.3).toFixed(0)),p=Number((s.rankList.length*.6).toFixed(0));d=d<1?1:d,m=m<2?2:m,p=p<3?3:p;for(let t=0; t<s.rankList.length; t++)if(t<d)s.rankList[t].medal=1;else if(t<m)s.rankList[t].medal=2;else if(t<p)s.rankList[t].medal=3;else break;i.Buffer.ContestRank.rankData(s.rankList,a.LID)}});function _(){var e;const u=XLSX.utils.book_new(),r="rank";var l;console.log(s.rankList);var d=["\u6392\u540D","\u7528\u6237","\u73ED\u7EA7","AC\u6570"];for(var m in a.Data)d.push(i.Utils.TSBaseTools.numberToAlpha(Number(m)+1));var p=[];console.log(d),console.log(p),p.push(d);for(var m in s.rankList){var o=s.rankList[m],t=[];t.push(Number(m)+1),t.push(o.Uname+"("+o.UID+")"),t.push(o.Uclass),t.push(o.Solved);for(var n in a.Data){var V=o.ProblemsMap[a.Data[n].PID];if(!V){t.push("");continue}if(V.Status=="AC"){t.push(V.Status);continue}t.push("("+V.SubmitNumber+")")}p.push(t)}console.log(p),l=XLSX.utils.aoa_to_sheet(p),console.log(l),XLSX.utils.book_append_sheet(u,l,r);const c=XLSX.write(u,{bookType:"xlsx",type:"binary"});console.log(c),e=new Blob([f(c)],{type:"application/octet-stream"}),console.log(e),h(a.LID+":"+a.Title+"\u7684\u6392\u540D.xlsx",e)}function f(e){const u=new ArrayBuffer(e.length),r=new Uint8Array(u);for(let l=0; l!==e.length; ++l)r[l]=e.charCodeAt(l)&255;return u}function h(e, u){const r=document.createElement("a");r.href=window.URL.createObjectURL(u),r.download=e,r.click()}async function P(){if(!i.$route.params.LID){i.elMessage({message:"\u8DF3\u8F6C\u5730\u5740\u9519\u8BEF\uFF0C\u8BF7\u91CD\u8BD5",type:"warning"});return}let e=i.elLoading({node:i.$refs.ListRank}),u=i.$route.params.LID;await I(u);let r=sessionStorage.getItem("listRankData"+a.LID);if(r&&(r=JSON.parse(r),r.LID==a.LID&&Date.now()-r.saveTime<1e4)){s.rankList=r.data,e.close();return}i.$get("api/training/"+u+"/rank").then(l=>{i.$log(l.data),s.calculate(l.data.Data),e.close()})}var a=Vue.reactive({LID:0,UID:"",Title:"",Description:"",BeginTime:0,Data:[],copy(e){let u=e.Problems.split(",");for(let r in u)for(let l in e.Data)if(u[r]==e.Data[l].PID){a.Data.push({PID:e.Data[l].PID,Title:e.Data[l].Title,Solved:0});break}a.LID=e.LID,a.UID=e.UID,a.Title=e.Title,a.Description=e.Description,a.BeginTime=e.StartTime}});async function I(e){await i.$get("/api/training/"+e).then(u=>{var l,d;let r=u.data;r.code==0&&a.copy(r),i.codeProcessor((l=r==null?void 0:r.code)!=null?l:100001,(d=r==null?void 0:r.msg)!=null?d:"\u670D\u52A1\u5668\u9519\u8BEF\\\\error")})}function v(e){if(e){if(e.Pioneer)return"background-color:#3DB03D !important; color: #eaeaea;";if(e.SubmitNumber>0)return e.Status=="AC"?"background-color:#E1FFB5 !important; color: #FEFEFE;":e.Status=="CE"?"background-color:#FFD0D0 !important; color: #FEFEFE;":"background-color:#FFD0D0 !important; color: #eaeaea;"}}function S(){let e={};if(i.$route.params.LID)e.LID=i.$route.params.LID;else{i.elMessage({message:"\u6570\u636E\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u8FDB\u5165\u6BD4\u8D5B\u754C\u9762",type:"warning"});return}i.$router.push({name:"List",params:e})}return Vue.onMounted(()=>{P()}),(e, u)=>{const r=Vue.resolveComponent("Back"),l=Vue.resolveComponent("el-icon"),d=Vue.resolveComponent("el-button"),m=Vue.resolveComponent("Medal"),p=Vue.resolveComponent("el-row");return Vue.openBlock(),Vue.createElementBlock("div",L,[Vue.createElementVNode("div",{class:"contestID cursor_pointer",onClick:u[0]||(u[0]= o=>S())},[Vue.createVNode(l,{size:"32px"},{default:Vue.withCtx(()=>[Vue.createVNode(r)]),_:1}),Vue.createElementVNode("div",null,Vue.toDisplayString(Vue.unref(a).LID),1)]),Vue.createElementVNode("div",N,[Vue.createElementVNode("div",E,Vue.toDisplayString(Vue.unref(a).Title),1),Vue.createElementVNode("div",w,Vue.toDisplayString(Vue.unref(a).Description),1)]),Vue.createVNode(d,{style:{margin:"auto"},onClick:u[1]||(u[1]= o=>_())},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u4E0B\u8F7D\u9898\u5355\u6392\u540D")]),_:1}),x,Vue.createElementVNode("div",C,[T,F,M,U,(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(a).Data,(o, t)=>(Vue.openBlock(),Vue.createElementBlock("div",{key:t,style:{width:"80px"}},Vue.toDisplayString(Vue.unref(i).Utils.TSBaseTools.numberToAlpha(t+1)+"("+o.Solved+")"),1))),128))]),(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(s).rankList,(o, t)=>(Vue.openBlock(),Vue.createElementBlock("div",{class:"item",key:t},[o.medal!=0?(Vue.openBlock(),Vue.createElementBlock("div",A,[Vue.createElementVNode("div",R,[o.medal==1?(Vue.openBlock(),Vue.createBlock(l,{key:0,size:"36px",color:"#fabd08"},{default:Vue.withCtx(()=>[Vue.createVNode(m)]),_:1})):o.medal==2?(Vue.openBlock(),Vue.createBlock(l,{key:1,size:"36px",color:"#d6d6d6"},{default:Vue.withCtx(()=>[Vue.createVNode(m)]),_:1})):(Vue.openBlock(),Vue.createBlock(l,{key:2,size:"36px",color:"#c57120"},{default:Vue.withCtx(()=>[Vue.createVNode(m)]),_:1}))]),Vue.createTextVNode(" "+Vue.toDisplayString(t+1),1)])):(Vue.openBlock(),Vue.createElementBlock("div",$,Vue.toDisplayString(t+1),1)),Vue.createElementVNode("div",X,Vue.toDisplayString(o.Uname)+"("+Vue.toDisplayString(o.UID)+")",1),Vue.createElementVNode("div",z,Vue.toDisplayString(o.Uclass),1),Vue.createElementVNode("div",j,Vue.toDisplayString(o.Solved),1),(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(a).Data,(n, V)=>(Vue.openBlock(),Vue.createElementBlock("div",{class:"problemStatus",key:V,style:Vue.normalizeStyle("width:80px;"+v(o.ProblemsMap[n.PID]))},[Vue.createVNode(p,null,{default:Vue.withCtx(()=>[(o.ProblemsMap[n.PID]&&o.ProblemsMap[n.PID].SubmitNumber>1||o.ProblemsMap[n.PID]&&o.ProblemsMap[n.PID].SubmitNumber>=1&&o.ProblemsMap[n.PID].Status!="AC")&&o.ProblemsMap[n.PID].Status!="AC"?(Vue.openBlock(),Vue.createElementBlock("div",O,Vue.toDisplayString(o.ProblemsMap[n.PID].Status),1)):Vue.createCommentVNode("",!0),Vue.createTextVNode(" \xA0 "),o.ProblemsMap[n.PID]&&o.ProblemsMap[n.PID].SubmitNumber>1||o.ProblemsMap[n.PID]&&o.ProblemsMap[n.PID].SubmitNumber>=1&&o.ProblemsMap[n.PID].Status!="AC"?(Vue.openBlock(),Vue.createElementBlock("div",q," (-"+Vue.toDisplayString(o.ProblemsMap[n.PID].Status=="AC"?o.ProblemsMap[n.PID].SubmitNumber-1:o.ProblemsMap[n.PID].SubmitNumber)+") ",1)):Vue.createCommentVNode("",!0)]),_:2},1024)],4))),128))]))),128))],512)}}});const H=B(J,[["__scopeId","data-v-bef685b0"]]);export{H as default};
